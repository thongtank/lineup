var $div=document.querySelector("div#container"),width=$div.offsetWidth,height=$div.offsetHeight;$(function(){var e,t=$("select#league"),n=$("select#team"),o=$("select#formation");$.getJSON("./data/league.json",function(e){$.each(e,function(e,n){t.append('<option value="'+e+'">'+n.name+"</option>")})}),$.getJSON("./data/formation.json",function(e){$.each(e,function(e,t){o.append('<option value="'+e+'">'+t.plan+"</option>")})}),$.getJSON("./data/formation.json",function(t){e=t}),t.change(function(){var e=$(this).val();n.html('<option value="">Select Team</option>'),""!=e&&$.getJSON("./data/league.json",function(t){t[e].hasOwnProperty("teams")&&$.each(t[e].teams,function(t,o){n.append('<option value="./img/logo/'+e+"/"+o.logo+'">'+o.name+"</option>")})})}),$("button#create").click(function(){var t=n.val(),a=o.val(),i=new Konva.Stage({container:"container",width:1200,height:627}),d=new Konva.Layer;i.add(d);var c=new Image;c.onload=function(){var e=new Konva.Image({image:c,x:0,y:0,draggable:!1});d.add(e),i.add(d)},c.src="./img/Field.jpg",$.each(e[a].formation,function(e,n){if("plan"==e)return!0;var o=n.x-21,a=n.y-21,c=new Image;c.src=t,c.onload=function(){var e=new Konva.Image({image:c,x:o,y:a,width:70,height:70,draggable:!0});e.on("mouseover",function(){document.body.style.cursor="pointer"}),e.on("mouseout",function(){document.body.style.cursor="default"}),d.add(e),i.add(d);var t=new Konva.Text({text:"Click to edit",x:o-65,y:a+75,fontSize:18,fill:"#fff",align:"center",width:200});d.add(t),d.draw(),t.on("click",function(){var e=t.getAbsolutePosition(),n=i.getContainer().getBoundingClientRect(),o=e.x+n.left+45,a=e.y+n.top,c=document.createElement("textarea");document.body.appendChild(c),c.value=t.text(),c.style.position="absolute",c.style.top=a+"px",c.style.left=o+"px",c.style.width=t.width(),c.focus(),c.addEventListener("keydown",function(e){13===e.keyCode&&(t.text(c.value),d.draw(),document.body.removeChild(c))})})}})})});